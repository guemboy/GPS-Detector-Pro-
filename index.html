<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GPS Detector Pro</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bg-color: #05080a;
            --safe: #00ff88; --warn: #f1c40f; --danger: #ff3e3e;
        }
        body { background: var(--bg-color); color: white; font-family: sans-serif; overflow: hidden; height: 100vh; }
        .main-container { max-width: 500px; margin: 0 auto; padding: 20px; text-align: center; }
        
        /* ‡∏ß‡∏á‡πÅ‡∏´‡∏ß‡∏ô Radar */
        .radar-box {
            position: relative; width: 280px; height: 280px; margin: 40px auto;
            border-radius: 50%; border: 2px solid rgba(0, 210, 255, 0.2);
            display: flex; align-items: center; justify-content: center; flex-direction: column;
        }
        .pulse {
            position: absolute; width: 100%; height: 100%;
            border: 4px solid var(--safe); border-radius: 50%;
            transition: all 0.1s ease; opacity: 0.5;
        }
        #value { font-size: 5rem; font-weight: 900; line-height: 1; }
        #status-txt { font-weight: bold; margin-top: 15px; min-height: 24px; }
        
        .btn-scan {
            background: #00d2ff; border: none; padding: 20px; width: 100%;
            border-radius: 15px; font-weight: bold; font-size: 1.2rem;
        }
        .instruction-card {
            background: rgba(255,255,255,0.05); padding: 15px; border-radius: 15px;
            margin-top: 30px; text-align: left; font-size: 0.85rem;
        }
    </style>
</head>
<body>

<div class="main-container">
    <div class="mt-3">
        <h4 class="mb-0">M-IT Magnetic Scanner</h4>
        <small class="text-secondary">‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡πÅ‡∏°‡πà‡πÄ‡∏´‡∏•‡πá‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏ß‡∏™‡∏π‡∏á</small>
    </div>

    <div class="radar-box" id="radar">
        <div class="pulse" id="ring"></div>
        <div id="value">00</div>
        <div class="small text-secondary">SENSITIVITY</div>
    </div>

    <div id="status-txt" class="text-info">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏Å‡∏•‡πâ‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏™‡∏á‡∏™‡∏±‡∏¢</div>

    <button id="start-btn" class="btn btn-scan mt-4 shadow-lg">
        <i class="fas fa-power-off me-2"></i>‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö
    </button>

    <div class="instruction-card">
        <b class="text-info">üí° ‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡∏Å‡∏≤‡∏£‡∏´‡∏≤ GPS Tracker:</b>
        <p class="mb-0 mt-1 text-secondary">
            1. ‡∏ñ‡∏∑‡∏≠‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏£‡∏ñ 1 ‡πÄ‡∏°‡∏ï‡∏£‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏£‡∏¥‡πà‡∏°<br>
            2. <b>"‡∏à‡∏∏‡∏î‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç":</b> ‡∏ô‡∏≥‡∏Ç‡∏≠‡∏ö‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡∏Ç‡∏≠‡∏á iPhone ‡∏à‡πà‡∏≠‡πÑ‡∏õ‡∏ï‡∏≤‡∏°‡∏à‡∏∏‡∏î‡∏ï‡πà‡∏≤‡∏á‡πÜ<br>
            3. ‡∏´‡∏≤‡∏Å‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÄ‡∏Å‡∏¥‡∏ô <b>20-30</b> ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô ‡πÅ‡∏™‡∏î‡∏á‡∏ß‡πà‡∏≤‡∏°‡∏µ‡πÅ‡∏°‡πà‡πÄ‡∏´‡∏•‡πá‡∏Å‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô
        </p>
    </div>
</div>

<script>
    let audioCtx = null;
    let oscillator = null;
    let lastHeading = null;
    let isDetecting = false;

    const startBtn = document.getElementById('start-btn');
    const valueDisp = document.getElementById('value');
    const ring = document.getElementById('ring');
    const statusTxt = document.getElementById('status-txt');

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á Beep
    function initAudio() {
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        oscillator = audioCtx.createOscillator();
        const gainNode = audioCtx.createGain();
        oscillator.type = 'sine';
        oscillator.connect(gainNode);
        gainNode.connect(audioCtx.destination);
        gainNode.gain.value = 0; // ‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô
        oscillator.start();
        return gainNode;
    }

    let audioGain;

    startBtn.addEventListener('click', async () => {
        if (!isDetecting) {
            if (typeof DeviceOrientationEvent.requestPermission === 'function') {
                const p = await DeviceOrientationEvent.requestPermission();
                if (p !== 'granted') return alert("‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Å‡πà‡∏≠‡∏ô");
            }
            audioGain = initAudio();
            isDetecting = true;
            startBtn.style.display = 'none';
            statusTxt.innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô... ‡∏ü‡∏±‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á Beep ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö";
            window.addEventListener('deviceorientation', handleMagnetic, true);
        }
    });

   let smoothedSense = 0; // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Ñ‡πà‡∏≤‡∏ô‡∏¥‡πà‡∏á‡∏Ç‡∏∂‡πâ‡∏ô

    function handleMagnetic(event) {
        let heading = event.webkitCompassHeading || (360 - event.alpha);
        
        if (lastHeading === null) {
            lastHeading = heading;
            return;
        }

        let diff = Math.abs(heading - lastHeading);
        if (diff > 180) diff = 360 - diff;

        // --- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏£‡∏≠‡∏á‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì (Exponential Smoothing) ---
        // ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÑ‡∏°‡πà‡∏Å‡∏£‡∏∞‡πÇ‡∏î‡∏î‡πÑ‡∏õ‡∏°‡∏≤‡∏à‡∏ô‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏≠‡∏≠‡∏Å ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡∏ï‡∏≠‡∏ö‡∏™‡∏ô‡∏≠‡∏á‡πÑ‡∏ß
        let rawSense = Math.min(Math.floor(diff * 60), 100); 
        smoothedSense = (rawSense * 0.2) + (smoothedSense * 0.8); 
        
        let finalDisplayValue = Math.round(smoothedSense);
        
        // ‡∏ï‡∏±‡∏î Noise ‡πÄ‡∏•‡πá‡∏Å‡πÜ ‡∏ô‡πâ‡∏≠‡∏¢‡πÜ ‡∏≠‡∏≠‡∏Å (‡∏ñ‡πâ‡∏≤‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤ 5 ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô 0)
        if (finalDisplayValue < 5) finalDisplayValue = 0;

        valueDisp.innerText = finalDisplayValue;

        // --- ‡∏õ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ï‡∏≤‡∏°‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡∏¥‡πà‡∏á‡πÉ‡∏´‡∏°‡πà ---
        if (finalDisplayValue > 25) {
            updateUI('#ff3e3e', "üö® ‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö‡πÅ‡∏°‡πà‡πÄ‡∏´‡∏•‡πá‡∏Å‡πÅ‡∏£‡∏á‡∏™‡∏π‡∏á!", 1.15);
            playBeep(600, 0.4); 
        } else if (finalDisplayValue > 8) {
            updateUI('#f1c40f', "‚ö†Ô∏è ‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡πÇ‡∏•‡∏´‡∏∞/‡πÅ‡∏°‡πà‡πÄ‡∏´‡∏•‡πá‡∏Å‡∏≠‡πà‡∏≠‡∏ô", 1.05);
            playBeep(300, 0.1);
        } else {
            updateUI('#00ff88', "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏Å‡∏ï‡∏¥ (Safe)", 1);
            if(audioGain) audioGain.gain.setTargetAtTime(0, audioCtx.currentTime, 0.2);
        }

        lastHeading = heading;
    }

    function updateUI(color, msg, scale) {
        ring.style.borderColor = color;
        ring.style.transform = `scale(${scale})`;
        ring.style.boxShadow = `0 0 30px ${color}`;
        statusTxt.innerText = msg;
        statusTxt.style.color = color;
        valueDisp.style.color = color;
    }

    function playBeep(freq, volume) {
        if (!audioGain) return;
        oscillator.frequency.setTargetAtTime(freq, audioCtx.currentTime, 0.1);
        audioGain.gain.setTargetAtTime(volume, audioCtx.currentTime, 0.1);
    }
</script>

</body>
</html>
